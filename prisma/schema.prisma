datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String          @id @default(cuid())
  email        String          @unique
  passwordHash String?          // bcrypt hash
  name         String?         
  provider     AuthProvider    @default(EMAIL)
  providerId   String?         @unique
  plan         Plan            @default(FREE)
  coins        Int             @default(10)

  generations  SvgGeneration[]

  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  resetPasswordToken   String?   // hashed token
  resetPasswordExpires DateTime?

  termsAcceptedAt   DateTime? 
  termsAcceptedIp   String?

  @@index([email])
  @@index([providerId])
}

model SvgGeneration {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String

  prompt     String
  svg        String   // the actual SVG code
  style      String?  // 'outline', 'duotone', etc.
  model      String?  @default("gpt-5-mini")
  coinsUsed  Int?     // optional
  privacy    Boolean  @default(false)
  
  createdAt  DateTime @default(now())

  @@index([userId, createdAt])
}

enum Plan {
  FREE
  STUDENT
  PRO
}

enum AuthProvider {
  EMAIL    // Traditional email/password
  GOOGLE   // Google OAuth
  GITHUB   // GitHub OAuth
}